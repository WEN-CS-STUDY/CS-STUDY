**프로세스의 정의 : 운영체제로부터 자원을 할당받은 작업의 단위**

**스레드의 정의 : 프로세스가 할당받은 자원을 이용하는 실행 흐름의 단위**

프로세스는 운영체제로부터 자원을 어떻게 할당받을까?

![image.png](/ASSET/프로세스.png)

그림과 같이 스택과 힙 데이터 텍스트 부분으로 나뉘어 메모리를 할당받는다.

- 스택 : 함수를 호출할때 할당되는 공간으로 함수가 종료되면 되돌아올 임시적인 자료를 저장하는 독립적인 공간이고, 함수가 종료되면 소멸된다.
- 힙 : 생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위해 존재하는 공간으로, 사용자에 의해 동적으로 할당되고 해제된다.
- 데이터 : 코드가 실행되면서 사용하는 전역 변수나 각종 데이터들이 모여있다.
- 텍스트 : 실제 우리가 작성하는 코드가 CPU가 해석 가능한 기계어 형태로 저장되어 있다.

위 사진을 보면 스택과 힙에 화살표는 둘다 코드를 실행중 동적으로 할당되기 때문에 스택은 아래로, 힙은 위로 메모리를 추가하여 사용한다.

스레드는 정의에서 말했듯 프로세스가 할당받은 자원을 이용하는데 스레드는 프로세스의 힙, 데이터, 텍스트 영역을 공유한다. 즉 스택영역만 따로 할당을 받는다.

일단 스택영역을 따로 할당받기 때문에 개별적으로 함수의 호출이 가능하고, 이 때문에 독립적인 실행 흐름이 추가된다를 의미한다.

그럼 왜 스레드가 필요할까? 그냥 멀티 프로세스로 하는 것과 뭐가 다를까?

프로세스는 각자의 메모리 영역이 존재하기 때문에 서로의 만약 다른 프로세스의 메모리를 사용해야 하는 일이 발생한다면 공유는 할 수 있지만 자원 부담이 크다.

하지만 스레드는 스택공간을 제외한 부분을 다른 스레드와 공유를 하기 때문에 자원의 공유의 자원 부담이 프로세스 끼리의 공유보다 훨씬 작기 때문에 멀티 스레드를 사용하는 것이 대중화가 되었다.

cpu는 실제로 프로세스가 아닌 스레드 단위로 작업을 수행하기 때문에 스레드 스케쥴링을 통해 작업의 순서를 정한다.

이때 같은 프로세스의 스레드는 공유자원을 사용하기 때문에 캐쉬 메모리의 변경도 적을 것이다. 때문에 이런 부분까지 고려하여 스케쥴링을 진행한다.

그럼 여기서 궁금한건 실제 spring boot 에서 프로세스와 스레드를 사용되는 방식은 어떻게될까?

먼저 하나의 서버는 하나의 프로세스이고, 스레드는 스레드 풀을 이용하여 스레드를 제공한다.

스레드 풀 이란?

스레드 풀 은 미리 일정 개수의 스레드를 생성하여 관리 하는 기법

즉 spring boot 에서 스레드 풀을 관리하며 요청이 오면 스레드 풀의 비어있는 스레드를 할당해주고, 응답이 끝나면 그 스레드를 다시 회수하여 대기 상태로 돌아가는 과정을 거친다.

스레드 풀의 장점

- 스레드의 개수를 제한할 수 있다.
- 스레드의 생성과 삭제의 오버헤드를 줄인다.